<div class="page-title">
  <h1>{{dispatchId > 0 ? 'Edit': 'Create'}} Vendor Invoice </h1>
  <div class="action-buttons">
    <button class="custom-button-regulr" (click)="onSavePress()">Save</button> 
    <!-- [disabled]="isFormInvalid() -->
    <button class="custom-button-secondary" (click)="onCancelPress()">
      Cancel
    </button>
  </div>
</div>

<div class="content-section p-3">
  <form [formGroup]="addOrEditDispatchNoteFormGroup">
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#Tab1">Tab 1
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#Tab2">Tab 2
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#Tab3">Tab 3
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#Tab4">Tab 4
        </a>
      </li>
    </ul>

    <div class="tab-content">
      <div id="Tab1" class="tab-pane fade show active">
        <div class="row">
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Vendor Name<span class="text-danger">*</span></label>
              <ng-select [searchable]="true" formControlName="vendorId" [readonly]="dispatchId > 0"
                (change)="onVendorSelect($event)">
                <ng-option *ngFor="let vendor of vendorsList" [value]="vendor.id">
                  {{ vendor.vendorName }}
                </ng-option>
              </ng-select>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Vendor Country <span class="text-danger">*</span></label>
              <input type="text" class="form-control" [value]="selectedVendorCountry" placeholder="Vendor country "
                readonly>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Invoice Date</label>
              <div class="input-group datepicker">
                <input class="form-control" placeholder="yyyy-mm-dd" name="fromDt" [autoClose]="true"
                  formControlName="invoiceDate" (dateSelect)="onInvoiceDateChange($event)" ngbDatepicker
                  #fromDt="ngbDatepicker" readonly />
                <button class="btn btn-outline-secondary bi bi-calendar3" (click)="fromDt.toggle()" type="button">
                  <img src="assets/images/icons/calendar.svg" alt="" width="15px" />
                </button>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">FY</label>
              <input formControlName="fy" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for=""> Client Invoice No <span class="text-danger">*</span></label>
              <input formControlName="clientInvoiceNo" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Due Date As Per Invoice <span class="text-danger">*</span></label>
              <div class="input-group datepicker">
                <input class="form-control" placeholder="yyyy-mm-dd" name="dueDateAsPerInvoice" [autoClose]="true"
                  formControlName="dueDateAsPerInvoice" [maxDate]="today"
                  (dateSelect)="onDateSelect('dueDateAsPerInvoice', $event)" ngbDatepicker #dueDateAsPerInvoice="ngbDatepicker"
                  readonly />
                <button class="btn btn-outline-secondary bi bi-calendar3" (click)="dueDateAsPerInvoice.toggle()"  type="button">
                  <img src="assets/images/icons/calendar.svg" alt="" width="15px" />
                </button>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for=""> Credit Days As Per Contract <span class="text-danger">*</span></label>
              <input formControlName="creditDaysAsPerContract" type="text" class="input-field"
                (input)="onCreditDaysChange()" (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Due Date As Per Contract <span class="text-danger">*</span></label>
              <div class="input-group datepicker">
                <input class="form-control" placeholder="yyyy-mm-dd" name="dueDateAsPerContract"
                  formControlName="dueDateAsPerContract" readonly />
                <button class="btn btn-outline-secondary bi bi-calendar3" type="button">
                  <img src="assets/images/icons/calendar.svg" alt="" width="15px" />
                </button>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Customer Name</label>
              <select formControlName="customerId" class="input-field">
                <option value="">Select Customer</option>
                <option *ngFor="let customers of customersList" [value]="customers.id">
                  {{ customers.customerName }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Description </label>
              <input formControlName="description" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Title </label>
              <input formControlName="title" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Application Number </label>
              <input formControlName="applicationNumber" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Filling Date </label>
              <div class="input-group datepicker">
                <input class="form-control" placeholder="yyyy-mm-dd" name="fillingDate" [autoClose]="true"
                  formControlName="fillingDate" [maxDate]="today" (dateSelect)="onDateSelect('fillingDate', $event)"
                  ngbDatepicker #fillingDate="ngbDatepicker" readonly />
                <button class="btn btn-outline-secondary bi bi-calendar6" (click)="fillingDate.toggle()" type="button">
                  <img src="assets/images/icons/calendar.svg" alt="" width="15px" />
                </button>
              </div>

            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Client Ref No</label>
              <input formControlName="clientRefNo" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Our Ref No </label>
              <input formControlName="ourRefNo" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Filing Receipt Supporting</label>
              <!-- <input formControlName="officialFilingReceiptSupporting" type="text" class="input-field"  /> -->
              <ng-select formControlName="officialFilingReceiptSupporting" class="input-field"
                placeholder="Select Yes or No">
                <ng-option [value]="'Yes'">Yes</ng-option>
                <ng-option [value]="'No'">No</ng-option>
              </ng-select>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Work Delivery Date Or Month</label>
              <div class="input-group datepicker">
                <input class="form-control" placeholder="yyyy-mm-dd" name="workDeliveryDateOrMonth" [autoClose]="true"
                  formControlName="workDeliveryDateOrMonth" [maxDate]="today"
                  (dateSelect)="onDateSelect('workDeliveryDateOrMonth', $event)" ngbDatepicker
                  #workDeliveryDateOrMonthDt="ngbDatepicker" readonly />
                <button class="btn btn-outline-secondary bi bi-calendar3" (click)="workDeliveryDateOrMonthDt.toggle()"
                  type="button">
                  <img src="assets/images/icons/calendar.svg" alt="" width="15px" />
                </button>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Currency</label>
              <ng-select formControlName="currencyPID" class="input-field" placeholder="Select Currency">
                <ng-option *ngFor="let country of countryList" [value]="country.currencyName">
                  {{ country.currencyName }}
                </ng-option>
              </ng-select>
            </div>
          </div>
        </div>
      </div>

      <div id="Tab2" class="tab-pane fade">
        <div class="edit-screen-subTable mt-0">
          <h4>
            Fee Details
            <button (click)="createPartDetailsGroup()" class="custom-button-regulr">Add</button>
          </h4>
        </div>

        <div class="custom-table">
          <table>
            <thead class="table table-bordered">
              <tr>
                <th>Line</th>
                <th>Fees Type</th>
                <th>Type</th>
                <th>Country</th>
                <th>Amount</th>
                <th>Remarks</th>
                <th class="text-center">Action</th>
              </tr>
            </thead>

            <tbody formArrayName="partdetails">
              <ng-container *ngFor="let vendorGroup of partDetails.controls; let ind = index">


                <tr formGroupName={{ind}}>

                  <td>{{ind+1}}</td>
                  <!-- Prof Fees -->
                  <td>
                    <div class="custom-form-input dispatchwidth">
                      <select class="form-control input-field" formControlName="feeType"
                        (change)="onFeeTypeSelect(getSelectedValue($event), ind)">
                        <option value="">Select Fee Type</option>
                        <option value="Professional Fee">Professional Fee</option>
                        <option value="Govt or Offical Fee">Govt or Offical Fee</option>
                        <option value="Other Charges">Other Charges</option>
                      </select>
                    </div>
                  </td>


                  <!-- SubItem -->

                  <td>
                    <div class="custom-form-input dispatchwidth">
                      <ng-select class="input-field" placeholder="Add Sub Fee" [items]="subFeeOptionsList[ind]"
                        bindLabel="value" bindValue="value" formControlName="subFeeValue">
                      </ng-select>
                    </div>
                  </td>

                  <!-- Country -->

                  <td>
                    <div class="custom-form-input dispatchwidth">
                      <ng-select class="input-field" placeholder="Select Country" formControlName="country">
                        <ng-option *ngFor="let country of countryList" [value]="country.countryName">
                          {{ country.countryName }}
                        </ng-option>
                      </ng-select>
                    </div>
                  </td>

                  <!-- Amount -->
                  <td>
                    <div class="custom-form-input dispatchwidthsmall">
                      <input formControlName="amount" class="input-field" type="text" placeholder="Enter Amt"
                        (keypress)="validateNo1($event)">
                    </div>
                  </td>

                  <!-- Remarks -->
                  <td>
                    <div class="custom-form-input dispatchwidth">
                      <input formControlName="remarks" type="text" class="input-field" placeholder="Remarks">
                    </div>
                  </td>

                  <!-- Action -->
                  <td class="text-center">
                    <img src="assets/images/icons/trash.svg" class="me-2 pointer" alt="Delete"
                      (click)="onDeletePartDetail(vendorGroup, ind)" />
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
        <!-- Totals Section -->
        <div class="row mt-4">
          <div class="col-lg-3 col-md-4">
            <div class="custom-form-input">
              <label for="">Professional Fee Total Amount</label>
              <input formControlName="professionalFeeAmt" type="text" class="input-field" readonly />
            </div>
          </div>
          <div class="col-lg-3 col-md-4">
            <div class="custom-form-input">
              <label for="">Govt/Official Fee Total Amount</label>
              <input formControlName="govtOrOfficialFeeAmt" type="text" class="input-field" readonly />
            </div>
          </div>
          <div class="col-lg-3 col-md-4">
            <div class="custom-form-input">
              <label for="">Other Charges Total Amount</label>
              <input formControlName="otherChargesAmt" type="text" class="input-field" readonly />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Discount Amount</label>
              <input formControlName="discountAmt" type="text" class="input-field" (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Discount CreditNote Amount</label>
              <input formControlName="discountCreditNoteAmt" type="text" class="input-field"
                (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Total Amount</label>
              <input formControlName="TotalAmt" type="text" class="input-field" readonly />
            </div>
          </div>
        </div>

      </div>

      <div id="Tab3" class="tab-pane fade show ">
        <div class="row">
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Payment Date</label>
              <!-- <input formControlName="paymentDate" type="text" class="input-field" /> -->
              <div class="input-group datepicker">
                <input class="form-control" placeholder="yyyy-mm-dd" name="paymentDate" [autoClose]="true"
                  formControlName="paymentDate" [maxDate]="today" (dateSelect)="onDateSelect('paymentDate', $event)"
                  ngbDatepicker #paymentDate="ngbDatepicker" readonly />
                <button class="btn btn-outline-secondary bi bi-calendar3" (click)="paymentDate.toggle()" type="button">
                  <img src="assets/images/icons/calendar.svg" alt="" width="15px" />
                </button>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Bank Name</label>
              <ng-select formControlName="bankID" class="input-field" placeholder="Select Bank">
                <ng-option *ngFor="let bank of transactionTypesList" [value]="bank.bankName">
                  {{ bank.bankName }}
                </ng-option>
              </ng-select>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">OWRM No 1</label>
              <input formControlName="owrmNo1" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">OWRM No 2</label>
              <input formControlName="owrmNo2" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Currency</label>
              <ng-select formControlName="currency2" class="input-field" placeholder="Select Currency">
                <ng-option *ngFor="let country of countryList" [value]="country.currencyName">
                  {{ country.currencyName }}
                </ng-option>
              </ng-select>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Payment Amount</label>
              <input formControlName="paymentAmount" type="text" class="input-field" (keypress)="validateNo1($event)" />
            </div>
          </div>
        </div>
      </div>

      <div id="Tab4" class="tab-pane fade show ">
        <div class="row">
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Customer PO Number</label>
              <input formControlName="customerPONo" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">PO Date</label>
              <!-- <input formControlName="poDate" type="text" class="input-field" /> -->
              <div class="input-group datepicker">
                <input class="form-control" placeholder="yyyy-mm-dd" name="poDate" [autoClose]="true"
                  formControlName="poDate" [maxDate]="today" (dateSelect)="onDateSelect('poDate', $event)" ngbDatepicker
                  #poDate="ngbDatepicker" readonly />
                <button class="btn btn-outline-secondary bi bi-calendar3" (click)="poDate.toggle()" type="button">
                  <img src="assets/images/icons/calendar.svg" alt="" width="15px" />
                </button>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">PO Value Inclusive Taxes</label>
              <input formControlName="poValueInclusiveTaxes" type="text" class="input-field" (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Professional Fee Invoice No</label>
              <input formControlName="professionalFeeInvoiceNo" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Currency</label>
              <ng-select formControlName="currency3" class="input-field" placeholder="Select Currency">
                <ng-option *ngFor="let country of countryList" [value]="country.currencyName">
                  {{ country.currencyName }}
                </ng-option>
              </ng-select>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Professional Fee Invoice Amount</label>
              <input formControlName="professionalFeeInvoiceAmount" type="text" class="input-field" (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Govt Fees Invoice No</label>
              <input formControlName="govtFeesInvoiceNo" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Official Fee Invoice Amount </label>
              <input formControlName="officialFeeInvoiceAmount" type="text" class="input-field" (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Our Invoice No</label>
              <input formControlName="ourInvoiceNo" type="text" class="input-field" />
            </div>
          </div>

          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Invoice Amount</label>
              <input formControlName="invoiceAmount" type="text" class="input-field"  (keypress)="validateNo1($event)"/>
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Govt Fee Invoice No</label>
              <input formControlName="govtFeeInvoiceNo" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Official Fee Inv Amount</label>
              <input formControlName="officialFeeInvoiceAmount" type="text" class="input-field"
                (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Estimate No Prof Fee</label>
              <input formControlName="estimateNoProfFee" type="text" class="input-field"
                (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Estimate No Govt Fee</label>
              <input formControlName="estimateNoGovtFee" type="text" class="input-field"
                (keypress)="validateNo1($event)" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Remarks</label>
              <input formControlName="remarks" type="text" class="input-field" />
            </div>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="custom-form-input">
              <label for="">Posted In Tally</label>
              <ng-select formControlName="postedInTally" class="input-field">
                <ng-option [value]="'Yes'">Yes</ng-option>
                <ng-option [value]="'No'">No</ng-option>
              </ng-select>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </form>
</div>



<div class="spinner" *ngIf="loadSpinner">
  Loading...
</div>