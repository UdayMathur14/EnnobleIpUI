<div class="custom-table">
  <!-- Invoice Table -->
  <div class="text-end mt-3">
    <button class="btn btn-primary" (click)="openPaymentModal()">Submit Payment</button>
  </div>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Select</th>
        <th>Invoice Date</th>
        <th>Invoice No</th>
        <th>Vendor Name</th>
        <th>Due Date</th>
        <th>Total Amount</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let bilti of biltisList; trackBy: biltisList.id">
        <td class="text-center">
          <input type="checkbox" [(ngModel)]="bilti.isSelected" />
        </td>
        <td>
          <span placement="end" tooltipClass="table-datetime-popover" [ngbTooltip]="tipContent">
            <u>{{ bilti?.invoiceDate | date:'dd-MM-yyyy'}}</u>
          </span>
          <ng-template #tipContent>
            <div>
              <div class="content-row">
                <span>Creation Date:</span>
                <span>{{ bilti.creationDate | date:'yyyy-MM-dd' }}</span>
              </div>
              <div class="content-row">
                <span>Created By:</span>
                <span>{{ bilti?.createdByDetails?.name }}</span>
              </div>
              <div class="content-row">
                <span>Last Update Date:</span>
                <span>{{ bilti.lastUpdateOn | date:'yyyy-MM-dd' }}</span>
              </div>
              <div class="content-row">
                <span>Last Updated By:</span>
                <span>{{ bilti?.lastUpdatedByDetails?.name }}</span>
              </div>
            </div>
          </ng-template>
        </td>
        <td>{{ bilti?.clientInvoiceNo || '-' }}</td>
        <td>{{ bilti?.vendorDetails.vendorName || '-' }}</td>
        <td>{{ bilti?.dueDateAsPerInvoice | date:'dd-MM-yyyy' }}</td>
        <td>{{ bilti?.totalAmount || '-' }}</td>
      </tr>
      <tr *ngIf="biltisList.length === 0">
        <td colspan="6" class="text-center">No Biltis Found</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ---------------- PAYMENT MODAL ---------------- -->
<ng-template #paymentModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Payment Details</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="paymentFreeDetails">
 <div class="mb-3 p-2 bg-light rounded">
  <span class="fw-bold text-dark">
    ðŸ’° Total Amount of Selected Invoices:
  </span>
  <span class="fw-bold text-danger ms-2">
    {{ selectedInvoicesTotal | number:'1.2-2' }}
  </span>
</div>

      <div formArrayName="paymentFeeDetails" *ngFor="let group of paymentFeeDetails.controls; let i=index">
        <div [formGroupName]="i" class="row g-2">
          <!-- Payment Date -->
          <div class="col-md-4">
            <label>Payment Date</label>
            <div class="input-group datepicker">
              <input class="form-control" placeholder="dd-MM-yyyy" formControlName="paymentDate"
                     ngbDatepicker #dp="ngbDatepicker" readonly />
              <button class="btn btn-outline-secondary" (click)="dp.toggle()" type="button">
                <img src="assets/images/icons/calendar.svg" width="15px" />
              </button>
            </div>
          </div>

          <!-- Bank -->
          <div class="col-md-4">
            <label>Bank</label>
            <ng-select formControlName="bankID" [items]="transactionTypesList" bindLabel="bankName" bindValue="id" placeholder="Select Bank" [appendTo]="'body'">
            </ng-select>
          </div>

          <!-- Payment Currency -->
          <div class="col-md-4">
            <label>Currency</label>
            <ng-select formControlName="paymentCurrency" [items]="currencyList" bindLabel="value" bindValue="value" placeholder="Select Currency" [appendTo]="'body'">
            </ng-select>
          </div>

          <!-- Rate -->
          <div class="col-md-4">
            <label>Rate</label>
            <input formControlName="rate" type="number" class="form-control" (keypress)="validateDecimal($event)" />
          </div>

          <!-- Quantity -->
          <div class="col-md-4">
            <label>Quantity</label>
            <input formControlName="quantity" type="number" class="form-control" />
          </div>

          <!-- Value (INR) -->
          <div class="col-md-4">
            <label>Value (INR)</label>
            <input formControlName="paymentAmount" type="number" class="form-control" readonly />
          </div>

          <!-- Bank Charges -->
          <div class="col-md-4">
            <label>Bank Charges</label>
            <input formControlName="bankCharges" type="number" class="form-control" (keypress)="validateDecimal($event)" />
          </div>

          <!-- Total Amount (INR) -->
          <div class="col-md-4">
            <label>Total INR</label>
            <input formControlName="totalAmountInr" type="number" class="form-control" readonly />
          </div>

          <!-- OWRM No -->
          <div class="col-md-4">
            <label>OWRM No</label>
            <input formControlName="owrmNo1" type="text" class="form-control" placeholder="OWRM No" />
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button class="btn btn-primary" (click)="submitPayment(); modal.close()">Submit Payment</button>
  </div>
</ng-template>
